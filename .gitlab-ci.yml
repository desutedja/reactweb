image: node:14.4.0

before_script:
  - npm i -g firebase-tools

stages:
  - deploy
  - build

cache:
  paths:
  - node_modules/
  - .yarn

build:
  stage: build
  only: 
    - clink-master
  script:
    - export CI=false
    - npm install
    - make build
    - make push

deploy:
  stage: deploy
  only: 
    - master
  script:
    - npm i -g firebase-tools
    - export CI=false
    - yarn install
    - yarn deploy
